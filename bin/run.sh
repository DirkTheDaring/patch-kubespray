#!/bin/sh -x
set -eu
cd "$(eval dirname \"$0\")"

BASENAME=$(basename -s .sh "$0")
ARRAY=(${BASENAME//-/ })

CONFIGURATION_NAME=${ARRAY[1]}
CONFIGURATION_STAGE=${ARRAY[2]}
CONFIGURATION_VARIANT=${ARRAY[3]}


CONFIGURATION_NAME=${CONFIGURATION_NAME:="fritz.box"}
CONFIGURATION_STAGE=${CONFIGURATION_STAGE="prod1"}
CONFIGURATION_VARIANT=${CONFIGURATION_VARIANT="default"}

INVENTORY=inventory/${CONFIGURATION_NAME}/${CONFIGURATION_STAGE}/${CONFIGURATION_VARIANT}
ENVIRONMENT="-e configuration_name=${CONFIGURATION_NAME} -e configuration_stage=${CONFIGURATION_STAGE} -e configuration_variant=${CONFIGURATION_VARIANT}"

ansible-playbook playbook.yml ${ENVIRONMENT} -i "${INVENTORY}" $*
